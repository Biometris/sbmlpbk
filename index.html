<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SBML PBK Model Simulation â€¢ sbmlpbk</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="SBML PBK Model Simulation">
<meta name="description" content="Package to load SBML PBK models in R for running simulations.">
<meta property="og:description" content="Package to load SBML PBK models in R for running simulations.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">sbmlpbk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/sbmlpbk.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="the-sbmlpbk-package">The <code>sbmlpbk</code> package<a class="anchor" aria-label="anchor" href="#the-sbmlpbk-package"></a>
</h1></div>
<p>An R package for importing Physiologically Based Kinetic (PBK) models encoded in the Systems Biology Markup Language (SBML) format, enabling simulation using the <code>deSolve</code> package. This package is still under development.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install from GitHub (using the <a href="https://github.com/r-lib/remotes" class="external-link">remotes</a> package):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Biometris/sbmlpbk"</span>, ref <span class="op">=</span> <span class="st">"main"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quickstart">Quickstart<a class="anchor" aria-label="anchor" href="#quickstart"></a>
</h2>
<div class="section level3">
<h3 id="loading-sbml-files">Loading SBML files<a class="anchor" aria-label="anchor" href="#loading-sbml-files"></a>
</h3>
<p>To load an SBML model from a file, simply use the <code>load_sbml</code> function. The following example loads the file <code>simple_oral.sbml</code> provided with the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://biometris.github.io/sbmlpbk/">sbmlpbk</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get filename</span></span>
<span><span class="va">file_simple_oral</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/"</span>, <span class="st">"simple_oral.sbml"</span>, package <span class="op">=</span> <span class="st">"sbmlpbk"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load model</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/load_sbml.html">load_sbml</a></span><span class="op">(</span><span class="va">file_simple_oral</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-simulations">Running simulations<a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h3>
<p>The code below shows how to run simulations on the model loaded above using the <code>ode</code> function of <code>deSolve</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package deSolve</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load model functions</span></span>
<span><span class="fu"><a href="reference/load_functions.html">load_functions</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load params</span></span>
<span><span class="va">params_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/"</span>, <span class="st">"simple_oral_params.csv"</span>, package <span class="op">=</span> <span class="st">"sbmlpbk"</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/load_params.html">load_params</a></span><span class="op">(</span><span class="va">model</span>, file <span class="op">=</span> <span class="va">params_csv</span>, param_instance <span class="op">=</span> <span class="st">"simple_PARAM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set input species</span></span>
<span><span class="va">input_species</span> <span class="op">&lt;-</span> <span class="st">"AGut"</span></span>
<span></span>
<span><span class="co"># Set input events (single unit bolus at time 1)</span></span>
<span><span class="va">eventdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_species</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial states</span></span>
<span><span class="va">initial_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set simulation times</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load deSolve model function</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_desolve_func.html">create_desolve_func</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_states</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">func</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">params</span>,</span>
<span>  events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eventdat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="helper-functions-for-unit-alignment-and-simulation">Helper functions for unit alignment and simulation<a class="anchor" aria-label="anchor" href="#helper-functions-for-unit-alignment-and-simulation"></a>
</h3>
<p><code>sbmlpbk</code> offers a number of functions to make it easier to run simulations with <code>deSolve</code> on loaded models for which time units have been specified. These functions automatically align e.g.Â time resolution and substance amount units of the model with the desired units for dosing and simulation.</p>
<p>The code below how the functions <code>create_desolve_times</code> and <code>create_desolve_events</code> are used to generate the <code>deSolve</code> timings and events, for a simulation of 10 days with a dosing pattern of a repeated bolus dose with amount 10, starting at day 4, repeating every day until time day 10.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create deSolve timings; 10 days with hourly evaluation resolution</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_desolve_times.html">create_desolve_times</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  duration <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">24</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">'d'</span> <span class="co"># time unit day</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create and set deSolve dosing events for the model</span></span>
<span><span class="va">eventdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_desolve_events.html">create_desolve_events</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  dosing_events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      target <span class="op">=</span> <span class="st">"AGut"</span>,</span>
<span>      dose_type <span class="op">=</span> <span class="st">"repeated_bolus"</span>,</span>
<span>      time <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      amount <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      interval <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      until <span class="op">=</span> <span class="fl">10</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="st">'d'</span>, <span class="co"># events time unit was in days</span></span>
<span>  amount_unit <span class="op">=</span> <span class="st">'ug'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial states</span></span>
<span><span class="va">initial_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load deSolve model function</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_desolve_func.html">create_desolve_func</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_states</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">func</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">params</span>,</span>
<span>  events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eventdat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up plotting layout</span></span>
<span><span class="va">n_cols</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_cols</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_rows</span>, <span class="va">n_cols</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through species and plot</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">species</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">out</span><span class="op">[</span>,<span class="va">species</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>       main <span class="op">=</span> <span class="va">species</span>,</span>
<span>       xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"time ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">time_unit</span>, <span class="st">"]"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>       ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">amount_unit</span>, <span class="st">"]"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="detailed-example">Detailed example<a class="anchor" aria-label="anchor" href="#detailed-example"></a>
</h2>
<p>For a more details, see the vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">'sbmlpbk'</span>, package<span class="op">=</span><span class="st">'sbmlpbk'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sbmlpbk</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Johannes Kruisselbrink <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Kruisselbrink.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
