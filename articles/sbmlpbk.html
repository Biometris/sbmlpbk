<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Load SBML and run simulation • sbmlpbk</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Load SBML and run simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sbmlpbk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/sbmlpbk.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Load SBML and run simulation</h1>
                        <h4 data-toc-skip class="author">Johannes
Kruisselbrink</h4>
            
            <h4 data-toc-skip class="date">2025-08-28</h4>
      

      <div class="d-none name"><code>sbmlpbk.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-sbmlpbk-package">The sbmlpbk package<a class="anchor" aria-label="anchor" href="#the-sbmlpbk-package"></a>
</h2>
<p>An R package for importing Physiologically Based Kinetic (PBK) models
encoded in the Systems Biology Markup Language (SBML) format, enabling
simulation using the <code>deSolve</code> package.</p>
<div class="section level3">
<h3 id="loading-a-model">Loading a model<a class="anchor" aria-label="anchor" href="#loading-a-model"></a>
</h3>
<p>Use the function <code>load_sbml</code> to load a PBK model from an
SBML file. As an example, the package includes a simple SBML PBK model
<code>simple_oral.sbml</code>. The following example shows how to load
the model from this file:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load SBML model from file</span></span>
<span><span class="va">file_simple_oral</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/"</span>, <span class="st">"simple_oral.sbml"</span>, package <span class="op">=</span> <span class="st">"sbmlpbk"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sbml.html">load_sbml</a></span><span class="op">(</span><span class="va">file_simple_oral</span><span class="op">)</span></span></code></pre></div>
<p>The output of the <code>load_sbml</code> function is an object of
class <code>sbmlModel</code>. This object is a named <code>list</code>
with of the following elements:</p>
<ul>
<li>
<strong>compartment: </strong> A named list with the IDs and default
sizes of the model compartments.</li>
<li>
<strong>species: </strong> A named list with the IDs and other info
of the model species.</li>
<li>
<strong>param: </strong> A named list with the IDs and (default)
values of the model parameters.</li>
<li>
<strong>function_defs: </strong> A list of the additional functions
defined in the SBML file, each in the form of character strings
representing R expressions.</li>
<li>
<strong>reactions: </strong> A list of reactions, each defined as a
list of ID, reactant (species ID), product (species ID), and kinetic law
(character string of R expression).</li>
<li>
<strong>assignment_rules: </strong> A list of the assignment rules
defined in the SBML file, each in the form of character strings
representing the R expression.</li>
<li>
<strong>rate_rules: </strong> A list of the rate rules defined in
the SBML file, each in the form of character strings representing the R
expression.</li>
<li>
<strong>odes: </strong> A list of ODEs generated from the SBML file,
each in the form of character strings representing the R
expression.</li>
<li>
<strong>default_params: </strong> Vector with the default values of
the parameters of the model.</li>
<li>
<strong>func: </strong> A <code>deSolve</code> compliant R-function
for running simulations using the <code>ode</code> function.</li>
</ul>
<p>The <code>summary</code> function can be used to get a short
description of the content of an <code>sbmlModel</code> object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==================</span></span>
<span><span class="co">#&gt; SBML Model Summary</span></span>
<span><span class="co">#&gt; ==================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Compartments:     5  [ Gut, Blood, Liver, Rest, Urine ]</span></span>
<span><span class="co">#&gt; Species:  5  [ AGut, ABlood, ALiver, ARest, AUrine ]</span></span>
<span><span class="co">#&gt; Parameters:   19     [ BW, VRc, VLc, VBc, QCC, ... ]</span></span>
<span><span class="co">#&gt; Functions:    0</span></span>
<span><span class="co">#&gt; Assignment rules:     6 </span></span>
<span><span class="co">#&gt; Rate rules:   0 </span></span>
<span><span class="co">#&gt; Reactions:    6 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time unit:    h </span></span>
<span><span class="co">#&gt; Amount unit:  ug </span></span>
<span><span class="co">#&gt; Volume unit:  L</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspecting-model-equations">Inspecting model equations<a class="anchor" aria-label="anchor" href="#inspecting-model-equations"></a>
</h3>
<p>To print the equations of the loaded model, type:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">'equations'</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # --- Assignment rules ---</span></span>
<span><span class="co">#&gt; Blood &lt;- BW * VBc</span></span>
<span><span class="co">#&gt; Liver &lt;- BW * VLc</span></span>
<span><span class="co">#&gt; Rest &lt;- BW * VRc</span></span>
<span><span class="co">#&gt; QC &lt;- BW^0.75 * QCC</span></span>
<span><span class="co">#&gt; QL &lt;- QC * QLc</span></span>
<span><span class="co">#&gt; QR &lt;- QC * QRc</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # --- Transfer ODEs ---</span></span>
<span><span class="co">#&gt; dAGut &lt;- -AGut * Ka</span></span>
<span><span class="co">#&gt; dABlood &lt;- -ABlood * QL/Blood + ALiver * QL/(Liver * PCLiver) - ABlood * QR/Blood + ARest * QR/(PCRest * Rest) - ABlood * CLUrine/Blood</span></span>
<span><span class="co">#&gt; dALiver &lt;- AGut * Ka + ABlood * QL/Blood - ALiver * QL/(Liver * PCLiver)</span></span>
<span><span class="co">#&gt; dARest &lt;- ABlood * QR/Blood - ARest * QR/(PCRest * Rest)</span></span>
<span><span class="co">#&gt; dAUrine &lt;- ABlood * CLUrine/Blood</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-simulations">Running simulations<a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h3>
<p>The code below shows how to run simulations using the
<code>ode</code> function of <code>deSolve</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load model functions</span></span>
<span><span class="fu"><a href="../reference/load_functions.html">load_functions</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load params</span></span>
<span><span class="va">params_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/"</span>, <span class="st">"simple_oral_params.csv"</span>, package <span class="op">=</span> <span class="st">"sbmlpbk"</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_params.html">load_params</a></span><span class="op">(</span><span class="va">model</span>, file <span class="op">=</span> <span class="va">params_csv</span>, param_instance <span class="op">=</span> <span class="st">"simple_PARAM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set input species</span></span>
<span><span class="va">input_species</span> <span class="op">&lt;-</span> <span class="st">"AGut"</span></span>
<span></span>
<span><span class="co"># Set input events (single unit bolus at time 5)</span></span>
<span><span class="va">eventdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_species</span><span class="op">)</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set simulation times</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial states</span></span>
<span><span class="va">initial_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load deSolve model function</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_desolve_func.html">create_desolve_func</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_states</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">func</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">params</span>,</span>
<span>  events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eventdat</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this example, the function <code>load_params</code> loads the
parameter values from a CSV file. Alternatively,
<code>model$default_params</code> can be passed to use the model’s
default parameters. The function <code>load_functions</code> loads the
additional functions defined in the SBML file. The function
<code>create_desolve_func</code> creates the function that can be used
as <code>func</code> argument of <code>deSolve</code>’s <code>ode</code>
function.</p>
<p>From here, the simulation output is ready for any further processing.
We can, for example, plot the output time series as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up plotting layout</span></span>
<span><span class="va">n_cols</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_cols</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_rows</span>, <span class="va">n_cols</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through variables and plot</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">species</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">out</span><span class="op">[</span>,<span class="va">species</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>       main <span class="op">=</span> <span class="va">species</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="va">species</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="sbmlpbk_files/figure-html/plotSimulationResults-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="running-dosing-scenarions">Running dosing scenarions<a class="anchor" aria-label="anchor" href="#running-dosing-scenarions"></a>
</h3>
<p>Running PBK model simulations with various dosing scenarios requires
construction of <code>deSolve</code> patterns. As PBK models may differ
in time resolution (e.g., hours/days) and dosing amounts (e.g., mg, ug,
moles) creation of dosing scenarios, running simulations, and evaluating
outputs requires alignment of the model’s time resolution and
dosing/output amounts with the desired resolutions. The methods and are
provided to assist with this. The method creates
<code>deSolve</code>-compatible events from a specified dosing scenario
in a user-specified time unit and amounts unit. Likewise, the method
creates a compliant sequence, specifying the times for which simulation
output is wanted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dosing_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># Single bolus dose of amount 20 at time 1 (in days)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    target <span class="op">=</span> <span class="st">"AGut"</span>,</span>
<span>    dose_type <span class="op">=</span> <span class="st">"single_bolus"</span>,</span>
<span>    time <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    amount <span class="op">=</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># Repeated bolus dose with amount 10, starting at day 4, repeating</span></span>
<span>  <span class="co"># every day until time day 10 </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    target <span class="op">=</span> <span class="st">"AGut"</span>,</span>
<span>    dose_type <span class="op">=</span> <span class="st">"repeated_bolus"</span>,</span>
<span>    time <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    amount <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    interval <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    until <span class="op">=</span> <span class="fl">10</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set simulation times; 10 days with hourly evaluation resolution</span></span>
<span><span class="va">num_days</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">evals_per_day</span> <span class="op">=</span> <span class="fl">24</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_desolve_times.html">create_desolve_times</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  duration <span class="op">=</span> <span class="va">num_days</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">evals_per_day</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">'d'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create and set deSolve dosing events</span></span>
<span><span class="va">eventdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_desolve_events.html">create_desolve_events</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">dosing_events</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="st">'d'</span>,   <span class="co"># events time unit was in days</span></span>
<span>  amount_unit <span class="op">=</span> <span class="st">'ug'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial states</span></span>
<span><span class="va">initial_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load deSolve model function</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_desolve_func.html">create_desolve_func</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_states</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">func</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">params</span>,</span>
<span>  events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eventdat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up plotting layout</span></span>
<span><span class="va">n_cols</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span> <span class="op">/</span> <span class="va">n_cols</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_rows</span>, <span class="va">n_cols</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through species and plot</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">species</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">out</span><span class="op">[</span>,<span class="va">species</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>       main <span class="op">=</span> <span class="va">species</span>,</span>
<span>       xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"time ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">time_unit</span>, <span class="st">"]"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>       ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">" ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">amount_unit</span>, <span class="st">"]"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="sbmlpbk_files/figure-html/createDoseEvents-1.png" width="672">
## Additional simulation outputs</p>
<p>Additional simulation outputs, such as dynamic parameters,
compartment sizes, but also outputs as concentrations, can be included
via the <code>outputs</code> argument of the
<code>create_desolve_func</code> function. In the code below, three
additional outputs are defined. Size of the blood compartment (i.e.,
blood volume), concentration in blood, and the value of the body weight
parameter (here constant during simulation).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define additional outputs</span></span>
<span><span class="va">outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Blood <span class="op">=</span> <span class="st">"Blood"</span>,</span>
<span>  CBlood <span class="op">=</span> <span class="st">"ABlood / Blood"</span>,</span>
<span>  BW <span class="op">=</span> <span class="st">"BW"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load deSolve model function with additional outputs</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_desolve_func.html">create_desolve_func</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  outputs <span class="op">=</span> <span class="va">outputs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_states</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">func</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">params</span>,</span>
<span>  events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eventdat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up plotting layout</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot amount of chemical in blood</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">out</span><span class="op">[</span>,<span class="st">'ABlood'</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>       main <span class="op">=</span> <span class="st">'ABlood'</span>,</span>
<span>       xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"time ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">time_unit</span>, <span class="st">"]"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">'ABlood'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through outputs and plot</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">output</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">outputs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">out</span><span class="op">[</span>,<span class="va">species</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>       main <span class="op">=</span> <span class="va">output</span>,</span>
<span>       xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"time ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">$</span><span class="va">time_unit</span>, <span class="st">"]"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>       ylab <span class="op">=</span> <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="sbmlpbk_files/figure-html/additionalOutputs-1.png" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Kruisselbrink.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
